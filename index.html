<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Spy Game - Names Edition</title>
    
    <!-- Modern Kurdish Font -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;500;700;900&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #4e54c8;
            --secondary: #8f94fb;
            --accent: #ff0055;
            --spy-bg: #e74c3c;
            --glass: rgba(255, 255, 255, 0.95);
            --shadow: 0 10px 30px rgba(0,0,0,0.2);
            --text-dark: #2d3436;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Vazirmatn', sans-serif; user-select: none; }
        body { margin: 0; padding: 0; min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; justify-content: center; align-items: center; overflow: hidden; position: relative; }

        /* BACKGROUND PARTICLES */
        .particles { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; z-index: 0; pointer-events: none; padding: 0; margin: 0; }
        .particles li { position: absolute; display: block; list-style: none; width: 20px; height: 20px; background: rgba(255,255,255,0.15); animation: rise 20s linear infinite; bottom: -150px; border-radius: 4px; }
        .particles li:nth-child(1){ left: 25%; width: 80px; height: 80px; animation-delay: 0s; }
        .particles li:nth-child(2){ left: 10%; width: 20px; height: 20px; animation-delay: 2s; animation-duration: 12s; }
        .particles li:nth-child(3){ left: 70%; width: 20px; height: 20px; animation-delay: 4s; }
        @keyframes rise { 0%{ transform: translateY(0) rotate(0deg); opacity: 1; } 100%{ transform: translateY(-1000px) rotate(720deg); opacity: 0; } }

        /* CONTAINER */
        .container { width: 90%; max-width: 480px; background: var(--glass); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border-radius: 24px; padding: 30px 25px; box-shadow: var(--shadow); text-align: center; z-index: 10; position: relative; transition: all 0.3s ease; max-height: 90vh; overflow-y: auto; }
        
        /* SCROLLBAR HIDDEN */
        .container::-webkit-scrollbar { display: none; }
        .container { -ms-overflow-style: none; scrollbar-width: none; }

        h1 { color: var(--text-dark); font-weight: 900; margin: 0 0 5px 0; font-size: 1.8rem; }
        .subtitle { color: #666; margin-bottom: 20px; font-size: 0.9rem; }

        /* INPUTS */
        .input-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .main-input { flex: 1; padding: 12px 15px; border: 2px solid #eee; border-radius: 12px; font-size: 1rem; outline: none; transition: 0.3s; text-align: right; }
        .main-input:focus { border-color: var(--primary); background: #fff; }
        
        .add-btn { background: var(--primary); color: white; border: none; border-radius: 12px; width: 50px; cursor: pointer; font-size: 1.2rem; transition: 0.2s; }
        .add-btn:active { transform: scale(0.9); }

        .names-list { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; justify-content: center; min-height: 40px; }
        .name-tag { background: #eef0f7; padding: 6px 12px; border-radius: 20px; font-size: 0.85rem; display: flex; align-items: center; gap: 8px; color: #444; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .name-tag i { color: var(--accent); cursor: pointer; opacity: 0.6; transition: 0.2s; }
        .name-tag i:hover { opacity: 1; transform: scale(1.2); }

        @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }

        .info-bar { display: flex; justify-content: space-between; align-items: center; background: #f8f9fa; padding: 10px 15px; border-radius: 12px; margin-bottom: 20px; font-size: 0.9rem; font-weight: bold; color: #555; }
        .spy-control { display: flex; align-items: center; gap: 10px; }
        .spy-control input { width: 50px; border: 1px solid #ccc; border-radius: 8px; text-align: center; padding: 5px; font-weight: bold; color: var(--accent); }

        /* BUTTONS */
        .btn { width: 100%; padding: 15px; border: none; border-radius: 14px; background: linear-gradient(135deg, #4e54c8, #8f94fb); color: white; font-size: 1.1rem; font-weight: 800; cursor: pointer; box-shadow: 0 8px 20px rgba(78, 84, 200, 0.3); transition: transform 0.2s; margin-bottom: 10px; display: flex; justify-content: center; align-items: center; gap: 10px; }
        .btn:active { transform: scale(0.97); }
        .btn.secondary { background: #f1f2f6; color: #444; box-shadow: none; }
        .btn.outline { background: transparent; border: 2px solid #ddd; color: #666; box-shadow: none; }

        /* CARD GAME */
        .card-container { perspective: 1000px; width: 100%; height: 320px; margin: 20px 0; position: relative; }
        .card { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1); border-radius: 20px; cursor: pointer; box-shadow: 0 15px 40px rgba(0,0,0,0.15); }
        .card.is-flipped { transform: rotateY(180deg); }
        .card.disabled { pointer-events: none; opacity: 0.9; cursor: wait; }

        .card-face { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; border-radius: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .card-front { background: linear-gradient(135deg, #1e3c72, #2a5298); color: white; border: 2px solid rgba(255,255,255,0.1); }
        .icon-large { font-size: 4rem; margin-bottom: 15px; opacity: 0.9; }
        
        /* BACK CARD */
        .card-back { background: white; transform: rotateY(180deg); color: #333; border: 4px solid #1e3c72; }
        
        /* SPY STYLE */
        .card.spy-active .card-back { background: var(--spy-bg); border-color: #000; }
        .card.spy-active .card-back .role-text { color: black; opacity: 0.8; }
        .card.spy-active .card-back .word-text { font-size: 5rem; margin: 0; } 
        .card.spy-active .card-back .desc { color: #222; font-weight: bold; }

        .role-text { font-size: 1.5rem; letter-spacing: 1px; color: #888; text-transform: uppercase; font-weight: bold; }
        .word-text { font-size: 2.8rem; font-weight: 900; color: #2a5298; margin: 15px 0; line-height: 1.1; }
        .desc { font-size: 0.9rem; color: #888; }

        /* UTILS */
        .hidden { display: none !important; }
        .error { color: #e74c3c; font-size: 0.85rem; margin-bottom: 10px; font-weight: bold; min-height: 18px; }
        .badge { background: #eee; padding: 5px 15px; border-radius: 50px; font-size: 1rem; color: #333; margin-bottom: 10px; display: inline-block; font-weight: bold; border: 1px solid #ddd; }

    </style>
</head>
<body>

    <ul class="particles"><li></li><li></li><li></li><li></li><li></li></ul>

    <!-- 1. SETUP SCREEN -->
    <div id="setup-screen" class="container">
        <h1>ÛŒØ§Ø±ÛŒ Ø³ÛŒØ®ÙˆÚ•Û•Ú©Û•</h1>
        <p class="subtitle">Ù†Ø§ÙˆÛŒ ÛŒØ§Ø±ÛŒØ²Ø§Ù†Û•Ú©Ø§Ù† Ø¨Ù†ÙˆÙˆØ³Û•</p>

        <div class="input-group">
            <input type="text" id="name-input" class="main-input" placeholder="Ù†Ø§ÙˆÛŒ ÛŒØ§Ø±ÛŒØ²Ø§Ù†..." onkeypress="handleEnter(event)">
            <button class="add-btn" onclick="addName()"><i class="fas fa-plus"></i></button>
        </div>

        <div id="names-list" class="names-list">
            <!-- Names appear here -->
        </div>

        <div class="info-bar">
            <div>ÛŒØ§Ø±ÛŒØ²Ø§Ù†: <span id="count-display">0</span></div>
            <div class="spy-control">
                <label>Ú˜Ù…Ø§Ø±Û•ÛŒ Ø³ÛŒØ®ÙˆÚ•:</label>
                <input type="number" id="num-spies" value="1" min="1" max="5">
            </div>
        </div>

        <div id="error-msg" class="error"></div>

        <button class="btn" onclick="startGame()">
            Ø¯Û•Ø³ØªÙ¾ÛŽÚ©Ø±Ø¯Ù† <i class="fas fa-play"></i>
        </button>
    </div>

    <!-- 2. GAME SCREEN -->
    <div id="game-screen" class="container hidden">
        <div class="badge" id="player-indicator">Unknown</div>
        <h2 style="margin: 0 0 10px 0;">Ú©Ù„ÛŒÚ© Ù„Û• Ú©Ø§Ø±ØªÛ•Ú©Û• Ø¨Ú©Û•</h2>
        
        <div class="card-container">
            <div class="card" id="game-card" onclick="handleCardInteraction()">
                <div class="card-face card-front">
                    <i class="fas fa-fingerprint icon-large"></i>
                    <h3>Ù‡Û•ÚµØ¯Ø§Ù†Û•ÙˆÛ•</h3>
                    <p style="opacity: 0.7; font-size: 0.8rem;">Ú©Ù„ÛŒÚ© Ø¨Ú©Û• Ø¨Û† Ø¨ÛŒÙ†ÛŒÙ†ÛŒ Ú•Û†ÚµÛ•Ú©Û•Øª</p>
                </div>
                <div class="card-face card-back">
                    <div class="role-text" id="role-text">...</div>
                    <div class="word-text" id="word-text">...</div>
                    <p class="desc" id="role-desc">...</p>
                </div>
            </div>
        </div>
        
        <p style="font-size: 0.9rem; color: #777; margin-top: 15px;">
            Ø¯ÙˆØ§ÛŒ Ø¨ÛŒÙ†ÛŒÙ†ÛŒ ÙˆØ´Û•Ú©Û•ØªØŒ Ø¯ÛŒØ³Ø§Ù† Ú©Ù„ÛŒÚ© Ø¨Ú©Û• Ø¨Û† Ø´Ø§Ø±Ø¯Ù†Û•ÙˆÛ• Ùˆ Ù¾ÛŽØ¯Ø§Ù†ÛŒ Ù…Û†Ø¨Ø§ÛŒÙ„ Ø¨Û• ÛŒØ§Ø±ÛŒØ²Ø§Ù†ÛŒ Ø¯ÙˆØ§ØªØ±
        </p>
    </div>

    <!-- 3. FINISH SCREEN -->
    <div id="end-screen" class="container hidden">
        <i class="fas fa-check-circle" style="font-size: 4rem; color: #2ecc71; margin-bottom: 20px;"></i>
        <h1>ØªÛ•ÙˆØ§Ùˆ!</h1>
        <p class="subtitle">Ù‡Û•Ù…ÙˆÙˆ ÛŒØ§Ø±ÛŒØ²Ø§Ù†Û•Ú©Ø§Ù† Ú•Û†ÚµÛŒ Ø®Û†ÛŒØ§Ù† Ø¨ÛŒÙ†ÛŒ.<br>Ø¦ÛŽØ³ØªØ§ Ú©Ø§ØªÛŒ Ø¯Û†Ø²ÛŒÙ†Û•ÙˆÛ•ÛŒ Ø³ÛŒØ®ÙˆÚ•Û•Ú©Û•ÛŒÛ•.</p>
        
        <button class="btn" onclick="restartSamePlayers()">
            Ø¯ÛŒØ³Ø§Ù† ÛŒØ§Ø±ÛŒ Ø¯Û•Ú©Û•ÛŒÙ†Û•ÙˆÛ• <i class="fas fa-redo"></i>
            <span style="font-size: 0.7em; opacity: 0.8; display: block;">(Ù‡Û•Ù…Ø§Ù† Ù†Ø§ÙˆÛ•Ú©Ø§Ù†)</span>
        </button>

        <button class="btn secondary" onclick="editPlayers()">
            Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ Ù†Ø§ÙˆÛ•Ú©Ø§Ù† <i class="fas fa-users-cog"></i>
        </button>

        <button class="btn outline" onclick="resetGame()">
            Ú•ÛŒØ³ÛŽØª (Ø³Û•Ø±Û•ØªØ§) <i class="fas fa-home"></i>
        </button>
    </div>

    <script>
        // --- DATA ---
        const rawWords = `Ø¦Ø§ÙˆØŒ Ø¦Ø§Ú¯Ø±ØŒ Ø®Ø§Ú©ØŒ Ø¨Ø§ØŒ Ú˜ÛŒØ§Ù†ØŒ Ù…Ø±Û†Ú¤ØŒ Ø¯ÚµØŒ Ú†Ø§ÙˆØŒ Ø¯Û•Ø³ØªØŒ Ø³Û•Ø±ØŒ Ù¾ÛŽØŒ Ù…Ø§ÚµØŒ Ø´Ø§Ø±ØŒ Ú¯ÙˆÙ†Ø¯ØŒ Ú•ÛŽÚ¯Ø§ØŒ Ø¦Ø§Ø³Ù…Ø§Ù†ØŒ Ù‡Û•ØªØ§ÙˆØŒ Ù…Ø§Ù†Ú¯ØŒ Ø¦Û•Ø³ØªÛŽØ±Û•ØŒ Ø´Û•ÙˆØŒ Ú•Û†Ú˜ØŒ Ø¨Û•Ù‡Ø§Ø±ØŒ Ù‡Ø§ÙˆÛŒÙ†ØŒ Ù¾Ø§ÛŒØ²ØŒ Ø²Ø³ØªØ§Ù†ØŒ Ø¨Ø§Ø±Ø§Ù†ØŒ Ø¨Û•ÙØ±ØŒ Ù‡Û•ÙˆØ±ØŒ Ø¦Ø§Ø²Ø§Ø¯ÛŒØŒ Ø®Û†Ø´Û•ÙˆÛŒØ³ØªÛŒØŒ Ú˜Ù†ØŒ Ù¾ÛŒØ§ÙˆØŒ Ù…Ù†Ø¯Ø§ÚµØŒ Ø¨Ø§ÙˆÚ©ØŒ Ø¯Ø§ÛŒÚ©ØŒ Ø¨Ø±Ø§ØŒ Ø®ÙˆØ´Ú©ØŒ Ù‡Ø§ÙˆÚ•ÛŽØŒ Ø¯Ø±Ø§ÙˆØ³ÛŽØŒ Ù…Ø§Ù…Û†Ø³ØªØ§ØŒ Ù‚ÙˆØªØ§Ø¨ÛŒØŒ Ú©ØªÛŽØ¨ØŒ Ù‚Û•ÚµÛ•Ù…ØŒ Ø²Ø§Ù†Ú©Û†ØŒ Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û•ØŒ Ú©Ø§Ø±ØŒ Ù¾Ø§Ø±Û•ØŒ Ø¨Ø§Ø²Ø§Ú•ØŒ Ù†Ø§Ù†ØŒ Ø¦Ø§Ø´ØŒ Ú¯Û†Ø´ØªØŒ Ø³Û•ÙˆØ²Û•ØŒ Ù…ÛŒÙˆÛ•ØŒ sÛŽÙˆØŒ Ù‡Û•Ù†Ø§Ø±ØŒ Ù‡Û•Ù†Ú¯ÙˆÛŒÙ†ØŒ Ø´ÛŒØ±ØŒ Ù¾Û•Ù†ÛŒØ±ØŒ Ú†Ø§ØŒ Ø®ÙˆØ§Ø±Ø¯Ù†ØŒ Ø®ÙˆØ§Ø±Ø¯Ù†Û•ÙˆÛ•ØŒ Ø¬Ù„ØŒ Ù¾ÛŽÚµØ§ÙˆØŒ Ú©ÚµØ§ÙˆØŒ Ø¨Û•Ø±Ú¯ØŒ Ú•Û•Ù†Ú¯ØŒ Ø³Ù¾ÛŒØŒ Ú•Û•Ø´ØŒ Ø³ÙˆÙˆØ±ØŒ Ø´ÛŒÙ†ØŒ Ø²Û•Ø±Ø¯ØŒ Ú©Û•Ø³Ú©ØŒ Ù…Û†Ø±ØŒ Ù‚Ø§ÙˆÛ•ÛŒÛŒØŒ Ù¾ÛŒØ±Û†Ø²ØŒ Ø¬ÙˆØ§Ù†ØŒ Ù†Ø§Ø´Ø±ÛŒÙ†ØŒ Ø¨Ø§Ø´ØŒ Ø®Ø±Ø§Ù¾ØŒ Ú¯Û•ÙˆØ±Û•ØŒ Ø¨Ú†ÙˆÙˆÚ©ØŒ Ú©Û†Ù†ØŒ Ù†ÙˆÛŽØŒ Ø¯Ø±ÛŽÚ˜ØŒ Ú©ÙˆØ±ØªØŒ Ù‚ÙˆØ±Ø³ØŒ Ø³ÙˆÙˆÚ©ØŒ Ú¯Û•Ø±Ù…ØŒ Ø³Ø§Ø±Ø¯ØŒ ÙˆØ´Ú©ØŒ ØªÛ•Ú•ØŒ Ø¨Û•Ø±Ø²ØŒ Ù†Ø²Ù…ØŒ Ø¯ÙˆÙˆØ±ØŒ Ù†Ø²ÛŒÚ©ØŒ Ø²Û†Ø±ØŒ Ú©Û•Ù…ØŒ Ù‡Û•Ù…ÙˆÙˆØŒ Ù‡ÛŒÚ†ØŒ Ø¦ÛŽÙ…Û•ØŒ Ø¦ÛŽÙˆÛ•ØŒ Ø¦Û•ÙˆØ§Ù†ØŒ Ù…Ù†ØŒ ØªÛ†ØŒ Ø¦Û•ÙˆØŒ Ø¦Û•Ù…Ú•Û†ØŒ Ø¯ÙˆÛŽÙ†ÛŽØŒ Ø³Ø¨Û•ÛŒØŒ Ø¦ÛŽØ³ØªØ§ØŒ Ø¯ÙˆØ§ØªØ±ØŒ Ù¾ÛŽØ´ØªØ±ØŒ Ú˜ÙˆÙˆØ±ØŒ Ø¯Û•Ø±Û•ÙˆÛ•ØŒ Ø³Û•Ø±Û•ÙˆÛ•ØŒ Ø®ÙˆØ§Ø±Û•ÙˆÛ•ØŒ Ù†Ø§ÙˆØŒ Ø¯Û•Ø±Û•ÙˆÛ•ØŒ Ù„Ø§ÛŒ Ú•Ø§Ø³ØªØŒ Ù„Ø§ÛŒ Ú†Û•Ù¾ØŒ Ù¾ÛŽØ´ØŒ Ø¯ÙˆØ§ØŒ Ù„Û•Ú¯Û•ÚµØŒ Ø¨ÛŽØŒ Ø¨Û†ØŒ Ù„Û•ØŒ Ø¨Û•ØŒ ÙˆØŒ ÛŒØ§Ù†ØŒ Ø¨Û•ÚµØ§Ù…ØŒ Ú†ÙˆÙ†Ú©Û•ØŒ Ø¦Û•Ú¯Û•Ø±ØŒ Ú©Û•ØŒ Ú†Û†Ù†ØŒ Ú©Û•ÛŒØŒ Ù„Û•Ú©ÙˆÛŽØŒ Ø¨Û†Ú†ÛŒØŒ Ú©ÛŽØŒ Ú†ÛŒØŒ Ú†Û•Ù†Ø¯ØŒ Ù‡Û•Ø±ØŒ Ù‡Û•ØªØ§ØŒ Ø²Ù…Ø§Ù†ØŒ Ú©ÙˆØ±Ø¯ÛŒØŒ Ú©ÙˆØ±Ø¯Ø³ØªØ§Ù†ØŒ Ù†ÛŒØ´ØªÙ…Ø§Ù†ØŒ ÙˆÚµØ§ØªØŒ Ú¯Û•Ù„ØŒ Ù†Û•ØªÛ•ÙˆÛ•ØŒ Ù…ÛŽÚ˜ÙˆÙˆØŒ Ú©Û•Ù„ØªÙˆÙˆØ±ØŒ Ù‡ÙˆÙ†Û•Ø±ØŒ Ú¯Û†Ø±Ø§Ù†ÛŒØŒ Ø´ÛŒØ¹Ø±ØŒ Ú†ÛŒØ±Û†Ú©ØŒ Ú•Û†Ù…Ø§Ù†ØŒ Ø´Ø§Ù†Û†ØŒ ÙÛŒÙ„Ù…ØŒ Ù…Û†Ø³ÛŒÙ‚Ø§ØŒ ÙˆÛŽÙ†Û•ØŒ Ø¬Û•Ú˜Ù†ØŒ Ø¦Ø§Ù‡Û•Ù†Ú¯ØŒ Ø´Ø§Ø¯ÛŒØŒ Ø®Û•Ù…ØŒ Ú¯Ø±ÛŒØ§Ù†ØŒ Ù¾ÛŽÚ©Û•Ù†ÛŒÙ†ØŒ ØªØ±Ø³ØŒ Ø¦Ø§Ø²Ø§ÛŒÛ•ØªÛŒØŒ Ù‡ÛŒÙˆØ§ØŒ Ø®Û•ÙˆÙ†ØŒ Ø¨ÛŒØ±ØŒ Ù‡Ø²Ø±ØŒ ÙÛ•Ù„Ø³Û•ÙÛ•ØŒ Ø²Ø§Ù†Ø³ØªØŒ ØªÛ•Ú©Ù†Û•Ù„Û†Ú˜ÛŒØ§ØŒ Ú©Û†Ù…Ù¾ÛŒÙˆØªÛ•Ø±ØŒ Ù…Û†Ø¨Ø§ÛŒÙ„ØŒ Ø¦ÛŒÙ†ØªÛ•Ø±Ù†ÛŽØªØŒ ØªÛ†Ú•ÛŒ Ú©Û†Ù…Û•ÚµØ§ÛŒÛ•ØªÛŒØŒ Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒØŒ Ù‡Ø§ØªÙˆÚ†Û†ØŒ Ø¦Û†ØªÛ†Ù…Ø¨ÛŽÙ„ØŒ ÙÚ•Û†Ú©Û•ØŒ Ù¾Ø§Ø³ØŒ Ø´Û•Ù…Û•Ù†Ø¯Û•ÙÛ•Ø±ØŒ Ø³Ø±ÙˆØ´ØªØŒ Ø¯Ø§Ø±Ø³ØªØ§Ù†ØŒ Ú†ÛŒØ§ØŒ Ø¯Û•Ø´ØªØŒ Ú•ÙˆÙˆØ¨Ø§Ø±ØŒ Ø¯Û•Ø±ÛŒØ§ØŒ Ú¯ÙˆÚµØŒ Ø¯Ø§Ø±ØŒ Ú¯ÛŒØ§ØŒ Ú¯ÛŒØ§Ù†Ø¯Ø§Ø±ØŒ Ø¨Ø§ÚµÙ†Ø¯Û•ØŒ Ù…Ø§Ø³ÛŒØŒ Ù…Ø§Ø±ØŒ Ù…ÛŽØ±ÙˆÙˆØŒ Ù…ÛŽØ´ØŒ Ù…ÛŽØ±ÙˆÙ„Û•ØŒ Ù¾Ø´ÛŒÙ„Û•ØŒ Ø³Û•Ú¯ØŒ Ù…Ø§Ù†Ú¯Ø§ØŒ Ø¨Ø²Ù†ØŒ Ù…Û•Ú•ØŒ Ø¦Û•Ø³Ù¾ØŒ ÙÛŒÙ„ØŒ Ø´ÛŽØ±ØŒ Ú¯ÙˆØ±Ú¯ØŒ Ú•ÛŽÙˆÛŒØŒ Ú©Û•Ø±ÙˆÛŽØ´Ú©ØŒ Ù…Ø´Ú©ØŒ Ù¾Û•Ú•Û•Ø³ÛŽÙ„Ú©Û•ØŒ Ú©Û†ØªØ±ØŒ Ù‡Û•ÚµÛ†ØŒ Ù‚Ø§Ø²ØŒ Ù…Ø±Ø§ÙˆÛŒØŒ Ú©Û•ÙˆØŒ Ø³ÛŒØ§Ø³Û•ØªØŒ Ø­Ú©ÙˆÙ…Û•ØªØŒ Ù¾Û•Ø±Ù„Û•Ù…Ø§Ù†ØŒ ÛŒØ§Ø³Ø§ØŒ Ø¯Ø§Ø¯Ú¯Ø§ØŒ Ù¾Û†Ù„ÛŒØ³ØŒ Ø³Û•Ø±Ø¨Ø§Ø²ØŒ Ø¬Û•Ù†Ú¯ØŒ Ø¦Ø§Ø´ØªÛŒØŒ Ø³Û•Ø±Ø¨Û•Ø®Û†ÛŒÛŒØŒ Ø¯ÛŒÙ…ÙˆÚ©Ø±Ø§Ø³ÛŒØŒ Ù…Ø§ÙÛŒ Ù…Ø±Û†Ú¤ØŒ Ø¯Ø§Ø¯Ù¾Û•Ø±ÙˆÛ•Ø±ÛŒØŒ ÛŒÛ•Ú©Ø³Ø§Ù†ÛŒØŒ Ø¦Ø§Ø¨ÙˆÙˆØ±ÛŒØŒ Ø¨Ø§Ø²Ø±Ú¯Ø§Ù†ÛŒØŒ Ú©Ø´ØªÙˆÚ©Ø§ÚµØŒ Ù¾ÛŒØ´Û•Ø³Ø§Ø²ÛŒØŒ Ú©Ø§Ù†Ø²Ø§ØŒ Ù†Û•ÙˆØªØŒ Ú©Ø§Ø±Û•Ø¨Ø§ØŒ ÙˆØ²Û•ØŒ Ø¦Ø§ÙˆØŒ ØªÛ•Ù†Ø¯Ø±ÙˆØ³ØªÛŒØŒ Ù†Û•Ø®Û†Ø´ÛŒØŒ Ø¯Û•Ø±Ù…Ø§Ù†ØŒ Ù†Û•Ø®Û†Ø´Ø®Ø§Ù†Û•ØŒ Ù¾Ø²ÛŒØ´Ú©ØŒ Ø¯Ú©ØªÛ†Ø±ØŒ Ø¯Û•Ø±Ù…Ø§Ù†Ø®Ø§Ù†Û•ØŒ ÙˆØ±Ø²Ø´ØŒ ØªÛ†Ù¾ÛŒ Ù¾ÛŽØŒ Ø¨Ø§Ø³Ú©Û•ØŒ ØªÛŽÙ†Ø³ØŒ Ù…Û•Ù„Û•ÙˆØ§Ù†ÛŒØŒ Ú•Ø§Ú©Ø±Ø¯Ù†ØŒ Ø¨Ø§Ø²Ø¯Ø§Ù†ØŒ Ù‡Û•ÚµÚ¯Ø±ØªÙ†ØŒ ÙÚ•ÛŒÙ†ØŒ Ú•Û†ÛŒØ´ØªÙ†ØŒ Ù‡Ø§ØªÙ†ØŒ Ú†ÙˆÙˆÙ†ØŒ ÙˆÛ•Ø³ØªØ§Ù†ØŒ Ø¯Ø§Ù†ÛŒØ´ØªÙ†ØŒ Ù‡Û•Ø³ØªØ§Ù†ØŒ Ø®Û•ÙˆØªÙ†ØŒ Ø®ÙˆØ§Ø±Ø¯Ù†ØŒ Ø®ÙˆØ§Ø±Ø¯Ù†Û•ÙˆÛ•ØŒ Ø¨ÛŒÙ†ÛŒÙ†ØŒ Ø¨ÛŒØ³ØªÙ†ØŒ Ù‡Û•Ø³Øª Ù¾ÛŽÚ©Ø±Ø¯Ù†ØŒ Ø¨Û†Ù† Ú©Ø±Ø¯Ù†ØŒ ØªØ§Ù… Ú©Ø±Ø¯Ù†ØŒ Ù‚Ø³Û• Ú©Ø±Ø¯Ù†ØŒ Ù†ÙˆÙˆØ³ÛŒÙ†ØŒ Ø®ÙˆÛŽÙ†Ø¯Ù†Û•ÙˆÛ•ØŒ ÙÛŽØ±Ø¨ÙˆÙˆÙ†ØŒ Ø¨ÛŒØ±Ú©Ø±Ø¯Ù†Û•ÙˆÛ•ØŒ Ø®Û†Ø´Û•ÙˆÛŒØ³ØªÛŒØŒ Ú•Ù‚ØŒ Ø¦ÛŒØ±Û•ÛŒÛŒØŒ Ø´Û•Ø±Ù…ØŒ Ø´Ø§Ù†Ø§Ø²ÛŒØŒ Ø¨Û•Ø®ØªÛ•ÙˆÛ•Ø±ÛŒØŒ Ù†Ø§Ø®Û†Ø´ÛŒØŒ Ú˜ÛŒØ§Ù†ØŒ Ù…Ø±Ø¯Ù†ØŒ Ù„Û•Ø¯Ø§ÛŒÚ©Ø¨ÙˆÙˆÙ†ØŒ Ú¯Û•Ø´Û•Ú©Ø±Ø¯Ù†ØŒ Ù¾ÛŒØ±Ø¨ÙˆÙˆÙ†ØŒ ØªÛ•Ù…Û•Ù†ØŒ Ø³Ø§ÚµØŒ Ù…Ø§Ù†Ú¯ØŒ Ù‡Û•ÙØªÛ•ØŒ Ú•Û†Ú˜ØŒ Ú©Ø§ØªÚ˜Ù…ÛŽØ±ØŒ Ø®ÙˆÙ„Û•Ú©ØŒ Ú†Ø±Ú©Û•ØŒ Ú©Ø§ØªØŒ Ø´ÙˆÛŽÙ†ØŒ Ø¨Û†Ø´Ø§ÛŒÛŒØŒ Ø¬ÛŒÙ‡Ø§Ù†ØŒ Ú¯Û•Ø±Ø¯ÙˆÙˆÙ†ØŒ Ø²Û•ÙˆÛŒØŒ Ø¦Ø§Ú¯Ø±ØŒ Ø¦Ø§ÙˆØŒ Ø®Ø§Ú©ØŒ Ø¨Ø§ØŒ ÙˆØ²Û•ØŒ Ú¯Û•Ø±Ù…Ø§ØŒ Ú•ÙˆÙˆÙ†Ø§Ú©ÛŒØŒ ØªØ§Ø±ÛŒÚ©ÛŒØŒ Ø¯Û•Ù†Ú¯ØŒ Ø¨ÛŽØ¯Û•Ù†Ú¯ÛŒØŒ Ø¬ÙˆÙˆÚµÛ•ØŒ ÙˆÛ•Ø³ØªØ§Ù†ØŒ Ù‡ÛŽØ²ØŒ Ù„Ø§ÙˆØ§Ø²ÛŒØŒ Ú˜Ù…Ø§Ø±Û•ØŒ ÛŒÛ•Ú©ØŒ Ø¯ÙˆÙˆØŒ Ø³ÛŽØŒ Ú†ÙˆØ§Ø±ØŒ Ù¾ÛŽÙ†Ø¬ØŒ Ø´Û•Ø´ØŒ Ø­Û•ÙˆØªØŒ Ù‡Û•Ø´ØªØŒ Ù†Û†ØŒ Ø¯Û•ØŒ Ø³Û•Ø¯ØŒ Ù‡Û•Ø²Ø§Ø±ØŒ Ù…Ù„ÛŒÛ†Ù†ØŒ Ù…Ù„ÛŒØ§Ø±`;
        const wordsList = rawWords.split('ØŒ').map(w => w.trim()).filter(w => w.length > 0);

        // --- STATE ---
        let playerNames = []; // Stores the names entered
        let gameSession = []; // Stores the shuffled players for the current round
        let currentIndex = 0;
        let isCardFlipped = false;
        let isProcessing = false;

        // --- UI REFERENCES ---
        const screens = {
            setup: document.getElementById('setup-screen'),
            game: document.getElementById('game-screen'),
            end: document.getElementById('end-screen')
        };
        const ui = {
            input: document.getElementById('name-input'),
            list: document.getElementById('names-list'),
            count: document.getElementById('count-display'),
            spies: document.getElementById('num-spies'),
            error: document.getElementById('error-msg'),
            card: document.getElementById('game-card'),
            role: document.getElementById('role-text'),
            word: document.getElementById('word-text'),
            desc: document.getElementById('role-desc'),
            badge: document.getElementById('player-indicator')
        };

        // --- SETUP LOGIC ---

        function handleEnter(e) {
            if (e.key === 'Enter') addName();
        }

        function addName() {
            const name = ui.input.value.trim();
            if (name.length > 0) {
                playerNames.push(name);
                ui.input.value = '';
                ui.input.focus();
                renderNames();
                ui.error.textContent = '';
            }
        }

        function removeName(index) {
            playerNames.splice(index, 1);
            renderNames();
        }

        function renderNames() {
            ui.list.innerHTML = '';
            playerNames.forEach((name, index) => {
                const tag = document.createElement('div');
                tag.className = 'name-tag';
                tag.innerHTML = `${name} <i class="fas fa-times" onclick="removeName(${index})"></i>`;
                ui.list.appendChild(tag);
            });
            ui.count.textContent = playerNames.length;
        }

        // --- GAME LOGIC ---

        function startGame() {
            const numSpies = parseInt(ui.spies.value);
            
            // Validation
            if (playerNames.length < 3) {
                ui.error.textContent = "ØªÚ©Ø§ÛŒÛ• Ù„Ø§Ù†ÛŒ Ú©Û•Ù… Ù†Ø§ÙˆÛŒ Ù£ ÛŒØ§Ø±ÛŒØ²Ø§Ù† Ø¨Ù†ÙˆÙˆØ³Û•";
                return;
            }
            if (numSpies >= playerNames.length) {
                ui.error.textContent = "Ú˜Ù…Ø§Ø±Û•ÛŒ Ø³ÛŒØ®ÙˆÚ•Û•Ú©Ø§Ù† Ø¯Û•Ø¨ÛŽØª Ú©Û•Ù…ØªØ± Ø¨ÛŽØª Ù„Û• ÛŒØ§Ø±ÛŒØ²Ø§Ù†Û•Ú©Ø§Ù†";
                return;
            }

            // 1. Select random target word for citizens
            const r = Math.floor(Math.random() * wordsList.length);
            const targetWord = wordsList[r];

            // 2. Clone and Shuffle Names (So order is random)
            let shuffledNames = [...playerNames];
            shuffledNames.sort(() => Math.random() - 0.5);

            // 3. Create Game Roles
            gameSession = [];
            
            // Add Spies (First N people in shuffled list get spy role temporarily, we shuffle again later to be safe or just map logic)
            // Actually easier: Create array of roles, shuffle roles, map to shuffled names
            let roles = [];
            for(let i=0; i<numSpies; i++) roles.push('spy');
            for(let i=0; i<(playerNames.length - numSpies); i++) roles.push('citizen');
            
            roles.sort(() => Math.random() - 0.5); // Shuffle roles

            // Map roles to the random order names
            for(let i=0; i<shuffledNames.length; i++) {
                if (roles[i] === 'spy') {
                    gameSession.push({ name: shuffledNames[i], role: 'spy', word: 'ðŸ˜' });
                } else {
                    gameSession.push({ name: shuffledNames[i], role: 'citizen', word: targetWord });
                }
            }

            // 4. Init Game State
            currentIndex = 0;
            isCardFlipped = false;
            isProcessing = false;
            
            // Reset Card UI
            ui.card.className = 'card'; // removes flipped/spy classes
            resetCardText();

            // Switch Screens
            screens.setup.classList.add('hidden');
            screens.end.classList.add('hidden');
            screens.game.classList.remove('hidden');

            updateBadge();
        }

        function handleCardInteraction() {
            if (isProcessing) return;
            isProcessing = true;
            ui.card.classList.add('disabled');

            if (!isCardFlipped) {
                // --- FLIP OPEN (SHOW ROLE) ---
                const player = gameSession[currentIndex];
                
                ui.word.textContent = player.word;
                
                if (player.role === 'spy') {
                    ui.role.textContent = "ØªÛ† Ø³ÛŒØ®ÙˆÚ•ÛŒØª";
                    ui.desc.textContent = "Ù…Û•Ù‡ÛŽÚµÛ• Ú©Û•Ø³ Ø¨Ø²Ø§Ù†ÛŽØª! Ù‡Û•ÙˆÚµØ¨Ø¯Û• ÙˆØ´Û•Ú©Û• Ø¨Ø²Ø§Ù†ÛŒØª";
                    ui.card.classList.add('spy-active');
                } else {
                    ui.role.textContent = "Ù‡Ø§ÙˆÚµØ§ØªÛŒ";
                    ui.desc.textContent = "Ø¦Û•Ù…Û• ÙˆØ´Û•ÛŒ Ù†Ù‡ÛŽÙ†ÛŒÛŒÛ•ØŒ Ø¨ÛŒÙ¾Ø§Ø±ÛŽØ²Û•";
                    ui.card.classList.remove('spy-active');
                }

                ui.card.classList.add('is-flipped');
                isCardFlipped = true;

                setTimeout(() => {
                    isProcessing = false;
                    ui.card.classList.remove('disabled');
                }, 600);

            } else {
                // --- FLIP CLOSE (PASS PHONE) ---
                ui.card.classList.remove('is-flipped');
                isCardFlipped = false;

                setTimeout(() => {
                    // Reset Card Style
                    ui.card.classList.remove('spy-active');
                    resetCardText();
                    
                    currentIndex++;
                    
                    if (currentIndex >= gameSession.length) {
                        finishGame();
                    } else {
                        updateBadge();
                        isProcessing = false;
                        ui.card.classList.remove('disabled');
                    }
                }, 600);
            }
        }

        function finishGame() {
            screens.game.classList.add('hidden');
            screens.end.classList.remove('hidden');
        }

        // --- POST GAME ACTIONS ---

        // 1. Restart with same names (Shuffle logic happens inside startGame)
        function restartSamePlayers() {
            startGame();
        }

        // 2. Go back to setup but keep list
        function editPlayers() {
            screens.end.classList.add('hidden');
            screens.setup.classList.remove('hidden');
        }

        // 3. Full wipe
        function resetGame() {
            playerNames = [];
            renderNames();
            ui.spies.value = 1;
            screens.end.classList.add('hidden');
            screens.setup.classList.remove('hidden');
        }

        function resetCardText() {
            ui.role.textContent = "...";
            ui.word.textContent = "...";
            ui.desc.textContent = "...";
        }

        function updateBadge() {
            if(gameSession[currentIndex]) {
                ui.badge.textContent = gameSession[currentIndex].name;
            }
        }
    </script>
</body>
</html>
